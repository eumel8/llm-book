<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Echo der Dunkelheit</title>
  <style>
    :root {
      --active-bg: #dbeafe; /* sanftes Blau */
      --border: #cbd5e1;    /* helles Grau */
    }
    /* :root { --active-bg: #fff3b0; --border: #e5e7eb; } */
    body {  background: #f9fafb; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .header {   background: #1e293b; color: white; position: sticky; top: 0; border-bottom: 1px solid var(--border); padding: .5rem .75rem; display: flex; gap: .75rem; align-items: center; }
    #fileName { opacity: .7; font-size: .9rem; }
    button {   background: #3b82f6; color: white; border: none; border-radius: .5rem; padding: .4rem .75rem; cursor: pointer; }
    button:hover { background: #2563eb; }
    #status { margin-left: auto; font-variant-numeric: tabular-nums; font-size: .9rem; }
    #viewer { height: calc(100vh - 48px); overflow: auto; outline: none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; white-space: pre-wrap; line-height: 1.5; }
    .line { padding: 0 .5rem; }
    .line.active {   background: var(--active-bg); linear-gradient(90deg, #dbeafe 0%, #f0f9ff 100%); border-left: 4px solid #3b82f6; font-weight: 500; border-left: 3px solid #f59e0b; }
    .line .num { display: inline-block; width: 4ch; opacity: .45; user-select: none; margin-right: .5rem; }
  </style>
</head>
<body>
  <div class="header">
    <button id="up" title="Pfeil hoch">▲</button>
    <button id="down" title="Pfeil runter">▼</button>
    <span id="fileName">ki-thriller-eurollm.md</span>
    <span id="status" aria-live="polite"></span>
  </div>
  <div id="viewer" tabindex="0" role="list" aria-label="Zeilenansicht"></div>

  <script>
    const FILE = 'ki-thriller-eurollm.md';
    const JUMP = 10; // PageUp/PageDown-Schritte
    let lines = [];
    let idx = 0;
    const viewer = document.getElementById('viewer');
    const status = document.getElementById('status');

    async function load() {
      try {
        const res = await fetch(FILE);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        lines = text.replace(/\r\n/g, "\n").split("\n");
        render();
        const hashIdx = parseHash();
        setActive(Number.isInteger(hashIdx) ? hashIdx : 0, true);
        viewer.focus();
      } catch (e) {
        viewer.textContent = 'Fehler beim Laden der Datei: ' + e.message;
      }
    }

    function render() {
      const frag = document.createDocumentFragment();
      for (let i = 0; i < lines.length; i++) {
        const div = document.createElement('div');
        div.className = 'line';
        div.dataset.index = i;
        const num = document.createElement('span');
        num.className = 'num';
        num.textContent = (i + 1).toString().padStart(3, ' ');
        const text = document.createTextNode(lines[i] === '' ? ' ' : lines[i]);
        div.appendChild(num);
        div.appendChild(text);
        div.addEventListener('click', () => { setActive(i, true); viewer.focus(); });
        frag.appendChild(div);
      }
      viewer.replaceChildren(frag);
    }

    function setActive(i, scroll) {
      if (i < 0 || i >= lines.length) return;
      const prev = viewer.querySelector('.line.active');
      if (prev) prev.classList.remove('active');
      idx = i;
      const el = viewer.children[i];
      if (!el) return;
      el.classList.add('active');
      if (scroll) el.scrollIntoView({ block: 'center' });
      status.textContent = `Zeile ${i + 1}/${lines.length}`;
      updateHash();
    }

    function parseHash() {
      if (location.hash.startsWith('#L')) {
        const n = parseInt(location.hash.slice(2), 10);
        if (!isNaN(n) && n >= 1 && n <= lines.length) return n - 1;
      }
      return null;
    }

    function updateHash() {
      history.replaceState(null, '', '#L' + (idx + 1));
    }

    function move(delta) {
      setActive(Math.max(0, Math.min(lines.length - 1, idx + delta)), true);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') { move(1); e.preventDefault(); }
      else if (e.key === 'ArrowUp') { move(-1); e.preventDefault(); }
      else if (e.key === 'PageDown') { move(JUMP); e.preventDefault(); }
      else if (e.key === 'PageUp') { move(-JUMP); e.preventDefault(); }
      else if (e.key === 'Home') { setActive(0, true); e.preventDefault(); }
      else if (e.key === 'End') { setActive(lines.length - 1, true); e.preventDefault(); }
    });

    document.getElementById('up').addEventListener('click', () => move(-1));
    document.getElementById('down').addEventListener('click', () => move(1));

    viewer.addEventListener('focus', () => {
      const active = viewer.querySelector('.line.active') || viewer.firstElementChild;
      if (active) active.scrollIntoView({ block: 'center' });
    });

    load();
  </script>
</body>
</html>
